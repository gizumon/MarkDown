---
tag:
  - Workshop
---

# Salesforceアプリケーションビルダー基礎

```
・ 講師: 北山 圭介さん
・ 実施場所: 三田研修センター
```

* [研修テキスト](https://salesforce.mimeo.digital/library)  

---
# Agenda
---
* [ __前置き__](#前置き)  
* [ __module1: AWコンピュータ社__](#module1:-awコンピュータ社)
* [ __module2: データモデルの宣言的な作成__](#module2:-データモデルの宣言的な作成)
* [ __module3: ユーザーインターフェースの作成__](#module3:-ユーザーインターフェースの作成)

---
# 前置き
## Salesforceとは
  * 世界TOPシェアのCRM(Customer Relationship Management)ソフトウェア
    * お客様の情報を管理するグループ = `CRM`
  * force.com => lightning platform
  * Salesforce全体のイメージ  
    ![SalesforceImage](https://gizumon.github.io/MarkDown/images/研修/SalesforceImage.PNG)  
  * 年にバージョンアップが3回(2月, 6月, 10月)
    * 自動で全ユーザー向けに適用される
    * 日本契約の場合、日本の週末深夜帯でバージョンアップ

## Salesforceサーバー
  * __マルチテナント__
    * 複数の会社の情報が同じサーバー上に存在
    * 一般的なクラウドでも同様
  * 組織(Organization)
    * 個々の会社を組織と呼ぶ
  * CPU、メモリの制限
    * 各組織単位で管理。
    > Q. CPU/メモリの上限を上げたい場合は、オプションがある？  
      ```
      A. ハードリミットあるものないものがある。  
        サポート対応が手厚いため、都度都度問い合わせて確認がベストとのこと。
      ```

# module1: AWコンピュータ社
  * 研修内で使う架空の会社
  * 中途採用向けの新規アプリケーション構築を例として、ケーススタディ

## 独自機能作りこみに関数開発手法
* `宣言的カスタマイズ`と、`プログラミング的カスタマイズ`方法がある。

### 宣言的カスタマイズ
  * 設定メニューから設定をしていく
  * 簡易に開発ができるが、汎用的なものがメイン
  * 単体テストレベルはSF側で担保。開発者は結合テストレベルの確認でOK。
  * バージョンアップの影響を受けにくい。
  * __本研修のターゲット__

### プログラミング的カスタマイズ
  * 上記の宣言的なカスタマイズで満たせない様なニーズはプログラミングでキャッチアップ
  * SF上の開発と、通常の開発は同じ規模感と考えてOK。
  * SF上の開発では、`データモデル`から考えていく必要がある。
    * 例：どんな情報が必要か。どんなテーブルが必要か。
  * SFサーバー上で動かしたいコードは`Apex`を用いて、開発をしていく。(Java, C言語に近い言語)

## Agile的な開発が多い
  > Q. 評価が大事だと思うが、SFにおけるAgile評価ってどのようなイメージ？フロントエンドだと、画面などUIちっくAgile評価が多いと思うが、  

## Sandbox
### メタデータ
* 設定情報のかたまり
* プログラムも含む
* XML形式でDL可能
* `SFで開発する = メタデータの編集`
### SandBoxの役割
* 本番組織のメタデータは開発用に触れないが、テスト環境には使いたい。
* Sandboxは本番組織のデータをコピーした`別の組織`
  > Q. Sandboxは作成した時の状態をコピー？それとも常に同期?
* Sandboxにコピーして、開発・テストしたメタデータを本番環境に反映。

### Sandboxの作成
* 開発者用画面
  * クイック検索 -> sandbox検索
  * Sandboxの種類はライセンス(Edition)により決まる
    * Developer, Developer Pro, Partial Copy, Full
      * 基本的にはストレージサイズの違い
      * Developerがついている種類では、メタデータのみがコピー
      * Proではレコードもコピーされる
  > Q. 作成のタイミングでApexクラスが指定できるが、これはなにか？
  ```
  Apexクラスはプログラミング開発的な方法で指定、あまり使われない。
  ```

* 補足：リリースタイミングの約1カ月前にSandboxに次回バージョンがリリースされる。
  * リリースノートを見て、影響ある場合は確認した方がベター

### お金のかからない開発環境
* Developer Edition
  * SFの開発者コミュニティ
    * developer editionの入手、無料でフル機能、無期限で使用可能
    * ライセンスが本番利用できない、ストレージが小さい
    * 開発者毎に作成OK
  * `推奨の開発方法`
    * Developer Edition: 各開発者で使用
    * Sandbox: 各開発者がDeveloper Editionで開発したものを持ち寄り、結合試験
* スクラッチorg
  * ガチ開発者向け

---
# module2: データモデルの宣言的な作成
---
## 基本用語
* オブジェクト
  * DBのテーブルに該当
* レコード
  * DBのレコード(タプル, 行)に該当
* 項目
  * DBのカラム(属性, 列)に該当
* 標準~
  * SF側で用意した要素のこと(例: 標準オブジェクト)
* カスタム~
  * 独自に追加した要素のこと(列: カスタムオブジェクト)
### 基本用語(画面周り)
* 選択リスト
  * ドロップダウンリスト
* 関連リスト
  * 一覧表(オブジェクト)の一種類、子供のレコードのリスト
* ルックアップ
  * 虫眼鏡のアイコン
  * 内部的にはID参照している
* 親子関係
  * １対多の関係の場合,１側が親。多側が子。  
   ![親子とUI上の見え方](https://gizumon.github.io/MarkDown/images/研修/親子とUI上の見え方.PNG)

## スキーマビルダー
* オブジェクト情報を参照してE-R図を生成してくれる
  > Q. E-R図を出力する機能はあるか。
  ```
  出力機能はなし、ハードコピーで対応
  ```

## 標準オブジェクトとカスタムオブジェクト
オブジェクトの作成は、宣言的な開発手法でしかできない。

### カスタムオブジェクト
* 組織事に後から追加した表
* カスタムオブジェクトを生成時、7つの標準項目が自動でできる
  * id
  * name　(テキスト or 自動採番)
    * label (多言語対応用)
  * CreatedById (作成者)
  * OwneredById (所有者 / アクセス権の付与が可能)
  * LastModifiedById
  * 最終更新日 / 作成日時
* カスタムオブジェクトはリレーションの設定が必要
* カスタムオブジェクトは `[テーブル名]__c` になる
* `レポート`機能では、集計や一覧表示が可能
  > Q. カスタムオブジェクトでは、標準項目のidが主キーになると思うが、任意のキーを主キーにはできない？
  ```
  できない。SFでは常にidで固定。ユニークな設定は可。
  ```

## オブジェクトリレーション
### データ型
* __参照関係__
* __主従関係__

  |項目|参照関係|主従関係|
  |---|---|---|
  |概要|緩やかな連携|密連携|
  |ルックアップ|空欄OK|空欄NG|
  |自己参照|可|不可|
  |所有者|別々OK|同じ|
  |親削除|アラート or 許容|一緒に消えちゃう|
  |積み上げ集計|不可|可 ※このケースのみ需要がある|
  |親子関係| - |親：標準/カスタム, 子：カスタム|

### 自己参照
  * オブジェクトをオブジェクト自身とリンクする
    * 例：取引先オブジェクトの取引先親会社

* __階層__ (ユーザーオブジェクトにおける自己参照)
  * あるユーザーを別のユーザーにリンクする
  * 承認プロセスでの使用が一般的


### 多対多リレーション
  * 多対多のパターン
    * 参照関係 × 2
    * 参照関係 + 主従関係
    * 主従関係 × 2 = `連結オブジェクト`
      * 連結オブジェクトは、主従関係の親オブジェクトになれなくなる  
      ![連結オブジェクト](https://gizumon.github.io/MarkDown/images/研修/連結オブジェクト.PNG)  

### 子リレーション名
  * 子リレーション名は親オブジェクトに登録される
    * 親オブジェクトが別の場合、同一の名前でも問題なし。
  * 子リレーション名は一般に複数系で定義する

### ルックアップ検索条件
* 以下でルックアップ検索条件を設定する
  * 項目 × 演算子 × 値/項目 × 項目
* 有効化無効化のチェックに注意

## レコードのインポート
* `CSV形式`でデータをアップロード
   * インポートウィザード
   * データローダ(dataloader.io)

|項目|インポートウィザード|データローダ|
|---|---|---|
|使用環境|開発画面内で実行可|インストールが必要|
|制限|商品・商談の項目が対応なし|対応|
|全角対応|一部文字化け|問題なし|
|Maxレコード|5万件以下|500万以下|
|レコード重複|回避|回避なし(主キー or 外部IDが必要)|
|データの出力/削除|△(他画面で)|〇|
|インポートのスケジューリング|×|〇|

* 以下の場合、作成日時と作成者に任意の値を入れることも可能
  * APIベースのデータ管理ツールからのみアクセス可能
    > Q. インポートウィザード、データローダ、dataloder.ioはAPIでない?
  * ユーザーが「レコードの作成時に監査項目を設定」にチェックがついている状態

## データの更新
* 既存レコードのカスタム属性にデータを追加可能

### SalesforceのレコードID
* 注意：各レコードは、`15桁`のIDと`18桁`のIDを持つ
* `18桁`の場合、3桁は大文字・小文字の識別子

## データの追加/更新 (アップサート)
* IDと外部IDどちらかを指定して、アップサート
  * 一致するIDが存在しない場合、追加
  * 1件のみ存在する場合、更新
  * (外部ID使用ケース) 2件以上存在する場合、エラー発報

### 外部ID
* SF以外のテーブルIDとして使用されていたIDなど、SFが用意したID以外の任意主キー
* 外部IDはユニークを保障はしない。処理側でエラーを出す
* 成功時、失敗時の挙動はAPIを使用するツールによって異なる
* 旧レコードに外部キーが存在する場合
  * 親のオブジェクトにも外部IDを設定していれば、  
    外部IDを使って外部キーをSFのIDに更新してくれる。
> 外部IDで、外部キーを更新する挙動のイメージはどんな感じ？
  ```
  CSVを取り込む際、レガシーのリレーションを引き継ぐ、
  外部キーと外部IDのリレーションの設定をする。
  これはAPIでも同様で、パラメータでリレーションを設定して更新しないと、
  リレーションを引き継いで更新はできない。
  ```

# module3:ユーザーインターフェースの作成
## 変えられるもの
* アプリケーションタブに表示可能なもの(タブ=オブジェクト)
* アプリケーションタブの順番
* リストビューのSelect項目(or Kanbanリストビュー)

---
### その他
* APIの研修: インテグレーションがついている研修
* 資格試験対象者: `理解度チェックの解答`に近いテストが出る
* データベースの基本: 親から更新していくこと