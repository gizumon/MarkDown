# サーバーレスアンチパターン
* 2020/07/09
* Keisuke Nishitani
* [資料](https://www.keisuke69.net/entry/2017/06/21/121501)

## AWS Lambdaの仕組み
* 水平方向にスケール
  * 1リクエストに1コンテナ、1イベントが使用される
* 1000リクエストあった場合、1000コンテナが動く
  * 全てがコールドスタートというわけでもない
* RDBとの相性が悪かった
  * AWS DynamoDBが推奨であった

## AWS LambdaとRDB
* RDBMSには最大同時接続数的なパラメータがある
  * しかし、実際に使い物になるかは別物
* リクエスト毎にコンテナが増え、各コンテナがRDBMSへコネクションを張る
* コネクションプールを使った場合でも、Lambda内でプールを張っても意味がない
* Lambdaの外でコネクションプールを作成する必要があった

## VPCアクセスのレイテンシコスト問題
* 現在は解消されている

## RDS proxy
* これで解決したらしい

## LambdaでEFS
* ステートフルなアプリケーションはNG!!!
* ステートレスなアプリケーションにすることを心がけること

---

### 調べる単語
* コネクションプール
  * DBで接続した状態を保持しておき、負荷を下げること
* スケールアウト/スケールアップ
  * スケールアウト：　サーバー台数増やすなど
  * スケールアップ：　サーバー自体の性能を上げる
* FargateとLambda 違い
  * fargate：　コンテナ実行環境
  * Lambda ：　１リクエスト使い捨て
  * [違い](https://www.ragate.co.jp/blog/articles/1566)
* ステートフルアプリケーションの例
  * リクエストを記憶しておき、アプリケーションの状態としてもつ必要があるようなもの