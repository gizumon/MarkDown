# サーバーのアーキテクチャ種類
* [参考文献](https://blog.yuuk.io/entry/2015-webserver-architecture#%E3%83%9E%E3%83%AB%E3%83%81%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89%E3%83%A2%E3%83%87%E3%83%AB)
## 種類
### [シリアルモデル](https://blog.yuuk.io/entry/2015-webserver-architecture#%E3%82%B7%E3%83%AA%E3%82%A2%E3%83%AB%E3%83%A2%E3%83%87%E3%83%AB)
  * 平行処理はなく、1プロセスで順次処理
### [マルチプロセスモデル](https://blog.yuuk.io/entry/2015-webserver-architecture#%E3%83%9E%E3%83%AB%E3%83%81%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%83%A2%E3%83%87%E3%83%AB)
  * リクエスト毎に子プロセスをフォークして実行
  * 実際にはprefork型などを使用し、あらかじめ準備した子プロセスに割り当てる様な動作をしているケースが多い
    * リクエスト → プロセス起動 → 割り当て → 処理 → 終了後プロセス破棄
    * (プロセス準備) → リクエスト → 割り当て → 処理 → (終了後、プロセスを別リクエストに割り当て)
  * prefork型では、リクエストが詰まる現象が発生する可能性がある
### [マルチスレッドモデル](https://blog.yuuk.io/entry/2015-webserver-architecture#%E3%83%9E%E3%83%AB%E3%83%81%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89%E3%83%A2%E3%83%87%E3%83%AB)
  * リクエスト毎にスレッドをフォークして実行
  * スレッドはプロセスよりもよりリソースに依存しない処理単位
  * １プロセスに複数スレッドを起動する事も可能
  * スレッドはリソースを共有するため、リソース競合を避ける様に注意する必要がある
### [イベント駆動モデル](https://blog.yuuk.io/entry/2015-webserver-architecture#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E9%A7%86%E5%8B%95%E3%83%A2%E3%83%87%E3%83%AB)
  * ブロッキングI/Oと非ブロッキングI/Oがある
  * ブロッキングI/Oは同期処理、非ブロッキングI/Oは非同期処理

# サーバーの種類
## Apatche
### 特徴
* マルチプロセスのプロセス駆動アーキテクチャ
  * 各リクエストにプロセスを割り当てて処理
    * 接続ごとにプロセスをフォーク≒コピーする
### メリット
* 一つ一つの処理のCPU負荷が高いケースでは、nginXと比較してパフォーマンスが向上する

### デメリット
* リクエスト毎にプロセスが確率されるため、メモリが枯渇しやすい
* 大量リクエスト時に、サーバーが重くなる

## nginX
### 特徴
* シングルスレッドモデルのイベント駆動アーキテクチャ
  * シングルスレッドでループし、キューに溜まったイベントを処理
  * ノンブロッキングI/Oと非同期のイベント駆動アーキテクチャ
### メリット
* 少量のプロセスで大量のリクエストを処理可能
* 同時接続数がApacheの10～100倍
### デメリット
* 一つ一つの処理が重たいケースでは、apatcheと比較してパフォーマンスが悪化する

## IIS (Internet Information Service)
### 特徴
* Microsoft製のWindows向けWebサーバーソフト
* Windows server や Windows pro などにインストール可能
* `Azureでは標準となるため、注意`
### メリット
* Windowsで利用可能
* GUIで設定・操作が可能
### デメリット
* Linux環境で動作しない
* ASP.NETで作られたサービスにのみメリット

## 早見表
|-|IIS|Apatche|nginX|
|---|---|---|---|
|シェア|32%|27%|25%|
|用途|Windows|Linux|Linux|
|対応言語|ASP.NETなど|PHPなど|PHPなど|
|信頼性|最高|高|高|
|サイト規模|大規模|大～小規模|大～小規模|
|動作速度|高速|高速|より高速|
|操作|GUI|CUI|CUI|
|料金|無料|無料|無料|
|難易度|易しい|やや難しい|難しい|
* [参考 Feb in 2018](https://news.netcraft.com/archives/2018/02/13/february-2018-web-server-survey.html)

# スレッドセーフとノンスレッドセーフ
## スレッドセーフ
* マルチスレッドで処理が実行された場合に問題が生じないことが考慮されている
## ノンスレッドセーフ
* マルチスレッドで処理が実行された場合が考慮されていないこと