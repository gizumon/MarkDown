---
tags:
  - 学習メモ
  - Pepper
---

# Pepper認定試験学習

---
* [1.はじめに](#1-はじめに)
* [2.ハードウェア仕様](#2-ハードウェア仕様)
* [3.取り扱い方法](#3-Pepperの取り扱い方法)
* [4.Coregraph](#4-Coregraph)
* [5.ボックス](#5-ボックス)

---

# 1. はじめに

## 用語
  * ボックス　  ：　ボックスの組み合わせによってロボアプリは作成
  * ビヘイビア　：　ボックスを組み合わせた一連の処理単位
  * ロボアプリ  ：　Pepper向けに開発されたアプリ

# 2. ハードウェア仕様
### Pepperのハードウェア

|ハードウェア |位置 |
|---|---|
|マイク|頭頂部の左右前後|
|スピーカー|頭部の左右耳|
|2Dカメラ|おでこのカメラ|
|3Dカメラ|右目赤外線照射、左目赤外線検出|
|解除キー|腰、足|
|タッチセンサ-|頭頂部中央の前・中・後ろ、左右手の甲|
|バンパーセンサ-|足前後計３箇所|
|ソナー|脚部正面、後方|
|充電フラップ|脚部後方|
|赤外線センサー|脚部前方２箇所|
|レーザーセンサー|脚部正面、左右前方３箇所、足元３箇所|
|ジャイロセンサー|胸部、脚部|
|胸部ボタン|ディスプレイ裏側|

### 関節の制御
* ヨー、ピッチ、ロールで表現
  * ![関節制御](https://gizumon.github.io/MarkDown/images/Pepper検定/関節制御.PNG)

### 解像度
* ディスプレイの解像度
  * 旧型： 1707 x 1067
  * 新型：  962 x 601
### RobotID(BodyID)の確認方法
  * 首の後ろのカバーを外した緊急停止ボタン付近に表記

# 3. Pepperの取り扱い方
## 箱からの出し方
1. 梱包箱を立てた状態で取り出す
2. 梱包箱の上部のミミ(フラップ)を固定用の穴に指しこみ固定
3. Pepperを抑えながら緩衝材を取り出す
4. 首を前に倒して、脇を抱えて持ち上げ、外に出す
5. アクセサリボックス(充電器一式)を取り出す

## 梱包方法
1. 蓋を開ける
2. 梱包箱の上部のミミ(フラップ)を固定用の穴に指しこみ固定
3. 緩衝材を取り出す
4. Pepperを`セーフレストの姿勢`にし、シャットダウン
5. `電源OFFの状態で、膝と腰に解除キー`を差し、関節の固定を解除
6. `緊急停止ボタンを押し`、意図しない起動がされない様にする
7. `充電フラップを閉じる`
8. Pepperの前面から脇を抱えて持ち上げ、`足から`押し込む
9. 梱包箱をゆっくり倒す
10. 頭、肩、手、腕を押し込む
11. アクセサリボックスを入れる
12. 閉じる

## 移動方法
### セーフレスト状態
* Pepperの重心が低くなり、倒れにくい姿勢
* スリープモード、レストモード、シャットダウン時にセーフレスト状態になる

### 手押し移動
1. `セーフレストの姿勢に`する
2. 腰 / 膝 の解除キーは取り外す
3. `充電フラップを開く`
4. 肩とお尻に手をあて押す
5. 足元の障害物に注意
* 緊急停止ボタン、胸部ボタンの押下に注意
* 電源ON時は、ホイール以外は動作継続中のため注意
* `電源OFF`/`レストモード` で実施。`スリープモード`は頭タッチで起動するため、NG。

### 持ち上げ移動
1. `シャットダウン`し、`セーフレストの姿勢に`する
2. `緊急停止ボタンを押下`状態に
3. 腰と膝の解除キーを取付
4. 胸の下に手をいれ、抱きかかえる様にして持ち上げ移動

## 起動と停止
### 起動・停止フロー
* 電源OFF時
  * 胸部ボタン　１回押下で起動
* 起動(ウェイクアップモード)時
  * 胸部ボタン　２回押下でレストモードへ
  * 額のカメラを隠しながら、頭部タッチセンサーを３秒触る　スリープモードへ
* レストモード時
  * 胸部ボタン　２回押下でウェイクアップモードへ
* スリープモード時
  * 頭部のタッチセンサーを触る　ウェイクアップモードへ

### 強制終了
* 電源ON時に`胸部ボタンを３秒以上`押下　`通常シャットダウン`
* `胸部ボタンを8秒以上`押下　強制シャットダウン
* 緊急停止ボタン押下　即時動作終了
  * 緊急時以外は、使用不可
  * 押下中は起動ロックがかかり、ロック解除まで電源が入らない
  * つまんで、時計回りに回すと、ロック解除
  * 移送時にも使用

## Pepperの設定
### 一般販売モデル
* ロボアプリランチャーから起動
### P4Bモデル
* 起動したら、お仕事が始まる
* 呼び込み後、左上を長押し
### ロボアプリの起動方法
* ロボアプリランチャー
  * 一般販売モデルでは、ロボアプリランチャーからロボアプリを起動
* お仕事簡単生成
  * ロボアプリ配信管理で設定した内容に合わせて、ロボアプリを起動
* その他の起動方法
  1. Pepeerにアプリをインストールしていない
     * Coregrapheでプロジェクトを開き、ツールバーの再生を押下。
  2. Pepperにアプリをインストールしている
     * Coregraphe上から起動。
     * qicliコマンドを実行して起動
   * 一般販売モデル：トリガーセンテンス、ロボアプリランチャー

### 肩のLEDランプ

|色|意味|
|---|---|
|白・点滅|正常|
|緑・点滅|通知あり|
|黄・素早く2回点滅|警告|
|赤・素早く2回点滅|エラー|
|赤・ゆっくり点滅|使用不可|

# 4. Choregraphe
## ポーズライブラリパネル
* StandZero：
* StandInit：
* Stand    ：

# 5. ボックス
## 入力・出力のデータ型

|項目|色|説明|
|---|---|---|
|Dynamic|灰|データの型は数値、文字列、配列、無し|
|Bang|黒|無し|
|Number|黄|数値|
|String|青|文字列|

# 6. 会話
## 会話関連ボックス
* Set language
* Say：特定の文字列を読み上げ
* Say Text：入力された言葉を読み上げ
* Animated Say：
* Speech Reco：聞き取り判定
* Dialog

## 設定値
* Voice shaping：声の高さ
* Speed：声の速さ
* Text：文字列

## イントネーションと抑揚の調整

|キー名|値範囲|用途|
|---|---|---|
|vct|50 ~ 200(def: 100)|声の高さ|
|rspd|50 ~ 400(def: 100)|声の速さ|
|pau|N [ms]|停止|
|vol|0 ~ 100%|音量|

* Pepperの標準：vct=135, rspd=110

### その他のイントネーション調整
* 漢字をひらがなに
* ひらがなの一部をカタカナに
* ひらがなの一部を別の漢字に
* 漢字を一音ずつ別の漢字に
* 「、」や「　」で間をあける
* 語尾をあげるには「？」をつける
* 語尾にいきおいをつけるには「っ」や「ッ」、「！」をつける
* 語尾を伸ばすには、「ー」や小さい母音(「ぁ」)を並べる

### 聞くと話すは完全分離
* 聞き取りモード：目とミミが青くくるくる回る
* SpeechRecoから発話させる場合、
  * onStopから結線する
  * wordRecognized, onNothingは聞き取りモードが継続する

## ダイアログボックス
### トピックファイル
* 基本的な構文に`ユーザールール`がある
```
u:(ユーザーの発話内容) ペッパーの返答
```

### ユーザーサブルール
* 階層化することも可能
```
u:(input1) answer
  u1:(input2) answer
  u1:(input3) answer
    u2:(input4) answer
      u3:(input5) answer
    u2:(input6) answer
```

### 複数単語の登録
* []で書くことで、複数単語を聞き取り単語に指定可能
```
u:(ユーザーセリフ) 〇〇は好きですか
  u1:([はい　好き]) answer
  u1:([いいえ 嫌い]) answer
```

* またconcept文を使用することで、トピック上部にまとめることも可能
  * `~` で呼び出し可能
```
concept:(yes)[はい 好き]
concept:(no)[いいえ 嫌い]

u:(ユーザのセリフ)◯◯は好きですか？
  u1:(~yes)「はい」に対するPepperの返答
  u1:(~no)「いいえ」に対するPepperの返答
```

* `{}`を用いることで、{}内の言葉があってもなくても判定可能になります。

### ボックスからの出力
* `$ボックスの出力名 = 値` で、ボックスを終了することができます。

```
u:(ユーザのセリフ)◯◯は好きですか？
  u1:(はい)「はい」に対するPepperの返答 $onStopped = 1
  u1:(いいえ)「いいえ」に対するPepperの返答 $onStopped = 2
```

### イベントの受け取り
* `e:イベント名` でイベントを受け取り可能
* 例：ボックス開始のイベント
  ```
  u:(e:onStart) Pepperのセリフ
  ```
* 例：聞き取りができなかった場合
  ```
  u1:(e:Dialog/NotUnderstood) すみません、聞き取れませんでした ^stayInScope
  ```
  * `^stayInScop` は、同じ階層(u1)にとどまることができるコマンドです
* 例：放置された時のイベント
  ``` 
  u:(e:Dialog/NotSpeeking15) 終了しちゃいますよ～
  ```
  * `e:Dialog/NotSpeekingN` Nは 5/10/15/20のどれか(秒数)

### ビヘイビア、サウンドの実行
* ビヘイビアの実行
  * `^start(アプリケーションID/ビヘイビア名)`
  * `^wait(アプリケーションID/ビヘイビア名)`
  * `^run(アプリケーションID/ビヘイビア名)`
    * ^runは途中で中断される可能性があります。
* サウンドの実行
  * `^startSound(サウンドファイル名)`
  * `^waitSound(サウンドファイル名)`
  * `^runSound(サウンドファイル名)`
    * ^runは途中で中断される可能性があります。

### proposal
```
proposal:プロポーザル１
proposal:プロポーザル２

u:(あ) ^nextProposal #「プロポーザル１」
u:(い) ^nextProposal #「プロポーザル２」
u:(う) ^previousProposal #「プロポーザル１」
u:(え) ^previousProposal #「プロポーザル２」
u:(お) ^sameProposal #「プロポーザル２」
```
* ^nextProposal = proposal + 1
* ^previousProposal = proposal - 1
* ^sameProposal = proposal

### proposalの応用

```
proposal:%key1 おはよう
proposal:%key2 こんにちは
```
* キーでバリュー呼び出すことが可能
* ^activate(key), ^deactivate(key), ^gotoReactive(key), ^gotoRandom(key)

## コラボラティブとノンコラボラティブ
* Solitaly状態の場合の会話にコラボラティブなものは会話に含まれる
* 「コラボラティブとしてパッケージに追加」 or トピックファイル設定
* ロボアプリ内でしか使われないトピックファイルは`ノンコラボラティブ`にすること

## 会話作成時の注意点
* 聞き返しとタイムアウト
  * タイムアウトの推奨時間は15[s]
* 聞き取り精度向上
  * なるべく多くの聞き取り単語の準備
  * ディスプレイに選択肢ボタンを配置

# 7. モーション

## ポーズライブラリ
  * `Stand`    : 基本姿勢
  * `StandInt` : 手を前に（NAO用）
  * `StandZero`: 手を上に（NAO用）

## インスペクタパネル
  * スライダー操作で、ロボットビューのPepperと実機が動く
  * アニメーションモード
    * 動作を定義できるモード
      * 目の色が`青`       : 通常モード
      * 目の色が`オレンジ` : アニメーションモード  
      * 目の色が`緑` : 関節の固定が解除
  * 実機での角度調整
    * 頭：　頭の天辺をタッチ, 再度タッチでロック
    * 腕：　手の甲をタッチ, 外すとロック

## Timelineボックス
  * 25フレームで1[s]
  * 500フレーム(20[s])以内で定義が推奨

### プラナームーブ
  * Pepperの動作を定義できるプランナー(X,Y,Θ)
  * 拡張子は.pmtとして保存
  
### セリフにモーションを定義する
```
  ^mode(disabled) ^start(ビヘイビアパス) セリフ ^wait(ビヘイビアパス)
```
1. ^mode(モード名) : 動作モード切り替える。
    * モード名：disabled/random/contextual
1. ^start(ビヘイビアパス) : モーションを開始する。
1. ^wait(ビヘイビアパス) : モーションが終了するのを待つ。
    * `wait が存在しない場合、モーション終了時点でビヘイビアも終了`。

## 動作設定時の注意点
  * `ポーズを１フレーム目に登録しない`
    * 関節のモーターに負荷がかかる
    * ユーザーが驚く
  * `ポーズを連続で登録しない`  
    * オーバーヒートしてPepperが停止する
  * `中途半端な姿勢を維持しない`
    * モーターが加熱してPepperが停止
    * アプリ終了時は直立姿勢に戻すこと
  * `腰の角度を深くしすぎない`
    * 転倒する (後方、斜め前方注意)
  * `タイムラインは500フレーム(20秒)以内`
    * 保守性の観点
  * `センサーの死角や予測できない利用者の動き`
  * `人と目を合わせる`
    * Basic Awarenessボックスを利用し、利用者の顔を見て会話させる
  * 開発時の注意
    * 動作を確認しない場合は`レストモード`にすること
      * 直立状態でもモーターに負荷がかかっている
    * アプリ内ではなるべく基本姿勢に戻す様にします
  * 独自モーションとの競合回避
    * 原則としてオートノマスライフを起動した状態で定義
      * オートノマスライフ ： `Basic Awareness` + `Breathing` が発動したままの状態になる
    * ロボアプリの演出と競合する。　⇒　状況によって解除を検討。
      * 例：Pepperの発話時には音への反応を解除。 ⇒　自分自身の音に反応するため。

### Autonomous Life 
  * `Basic Awareness`
    * 人と目を合わせる
    * 音がした方を向く
    * ディスプレイを触られた方を向く
  * `Breathing Animation`
    * 呼吸しているように胸を動かす
  * ライフサイクル管理
    1. `Solitary`     ：ライフサイクルの中心
    2. `Interactive`  ：Solitaryモードからアプリ実行で遷移
    3. `Safegurd`     ：リフレックス発生時に遷移
    4. `Disabled`     ：リフレックス失敗時などに遷移

# 8. イベント
### Pepperのセンサーとメモリ名

|部位 |イベント名 |説明|
|---|---|---|
|頭|Front __Tactil__ Touched|頭の前方。|
|  |Middle __Tactil__ Touched|頭の天辺。|
|  |Rear __Tactil__ Touched|頭の後方。|
|腕|__Hand__ LeftBackTouched|左手の甲。|
|  |__Hand__ RightBackTouched|右手の甲。|
|バンパー|Left __Bumper__ Pressed|左前バンパー。|
||Right __Bumper__ Pressed|右前バンパー。|
||Back __Bumper__ Pressed|後方バンパー。|

* タッチ系イベントは、触った時と離したとき２回実行される
  * `Only onceボックス`をはさむ

### 主要な対人系イベント
* EngagementZone   :  
  * PersonEnterdZone1 : 人が半径 `1.0メートル` 周囲に入ったとき。
  * PersonEnterdZone2 : 人が半径 `2.5メートル` 周囲にはいった時。
* PeoplePerception : 
  * JustArrived : 新しい人を見つけてIDを採番し、リストに追加したとき。
  * JustLeft    : リストに登録した人がいなくなったとき。
* イベント名の例: EngagementZones/PersonEnterdZone1

# 9. ディスプレイ
## ディスプレイ表示の仕組み
* WebViewアプリを起動し、Pepper内のWebサーバーにアクセス

## ディスプレイへの画像表示
* ShowImageボックス
  * __[html]__ フォルダの直下に保存する必要あり。
  * 画像のフォーマットは [JPEG] または [PNG] 
* 旧型ディスプレイと新型ディスプレイの対応
  * 旧型：1707 * 1067 
  * 新型：962 * 901

### 注意点
* 画像のキャッシュが残る

### タブレットタッチ位置の座標取得
* タッチしたタブレットのX,Y位置を取得

### viweportの指定
* 新旧タブレットサイズが異なるため、画像がうまく適用されない可能性がある
* `viewport 1.335`で定義されている場合、adjust.jsで互換性を保てる
* 定義なしor1の場合には、adjust23.js

## ディスプレイ表示の注意点
* ディスプレイ表示の注意点
  * 字はできる限り大きく
  * 文字と背景のコントラスト比を高く
  * ボタン連打への対応
  * ピンチイン・ピンチアウトの無効化
  * 操作は音声 + ディスプレイ両方でできる様に
  * ディスプレイのタイムアウト処理
* 最大サイズ ⇒ 横2048px  ×　縦2048px (お仕事簡単生成の仕様)

# 10. オートノマスライフ



### Pepperのお仕事更新タイミング
1. Pepper本体のディスプレイからお仕事更新選択時。
2. Pepperがお仕事実行中に、お仕事の更新があった時。(60秒間隔)

### インタラクション分析
1. 接客分析
     * 機体別：　性別　×　機体　×　お仕事　×　平均接客時間
2. お仕事分析
     * お仕事別：　採用件数　×　接客件数　×　コンバージョン件数　×　離脱数　×　平均接客時間
3. コンバージョン分析
     * コンバージョン設定箇所の詳細分析
4. 離脱分析
     * 離脱の詳細分析
5. 質問分析
     * 集計結果：　年代　×　性別
     ```
      質問ボックス　⇒　質問内容
      メニューボックス　⇒　ボックス名
     ```

### Pepper for Bizと一般販売モデル比較

|項目|P4B|一般販売|
|---|---|---|
|感情エンジン|△　マイアプリ対応|〇|
|クラウドAI|×　データ取り扱い上NG|〇|
|雑談|△　10種対応|〇　ある程度可能|
|マイアプリ|〇　お仕事簡単生成に適用する範囲|△　配信不可|
|お仕事簡単生成|〇|×|
|インタラクション分析|〇|×|
|故障交換対応|〇|×|
|Solitaryロボアプリ|×|〇|
|アプリ起動方法|ディスプレイ|ディスプレイ/起動トリガー/起動センテンス|
|インストール方法|クラウドサービス|ローカルPC|


### UXレビュー観点

|レビュー観点|内容|
|----|---|
|画面|コントラストは高く|
|ボタン|押した感触が伝わるデザイン|
|中断ボタン|中断したいときに中断できる|
|ローディング|5秒以下|
|画面遷移|1秒以下|
|アプリフォルダの容量|100MB以下|
|インタラクション分析のカスタムラベル|50以内|
|肩のLED|使用していないこと|
|音声ファイル|ogg|
|タイムアウト時の戻り値|9999|

### P4B3のマイアプリ登録
* ロボアプリをクラウド経由で配信
* ビヘイビアパス：ロボアプリに必要
  * __ビヘイビアパスはマイアプリを開発したベンダー様がロボアプリを利用するお客様に伝える__

### お仕事の配信
* お仕事を作成したSBRアカウントでログインする機体全てに配信される。
  * 機体リストはインタラクション分析用
* 他のSBRアカウント間でデータのI/Eは可能。
  * お仕事簡単生成1.0　⇒　お仕事簡単生成2.0　は不可。
* 機体本体には300MBまでお仕事を保存可能。
  * 超える場合には、古いものから削除される
  * 一つのお仕事の最大容量は100MB

### キーワードのイントネーション調節
* 語尾を高くする
  * ?
  * っ
  * ッ
* キーワードに間を入れる
  * ッ。ッ。
  * っ。っ。

### メディアライブラリ
 * 対応するファイルの種類
   * mp4, gif, jpg, jpeg, png, ogg
   * __mp3は対象外__
