---
tag:
  - 学習メモ
  - 高度情報試験学習
---

---
# 第一章目次

<details>
<summary>開く</summary>

  * [ ] [SQL言語](#第一章：SQL)  
  * [ ] [1.1_SELECT文](#11-SELECT文)  
  * [ ] [1.1.1_選択項目リスト](#111-選択項目リスト)  
  * [ ] [1.1.2_SELECT文で使う条件設定](#112-SELECT文で使う条件設定) 
  * [ ] [1.1.3_GROUP_BY句と集約関数](#113-GROUP-BY句と集約関数)  
  * [ ] [1.1.4_整列(ORDER_BY_句)](#114-整列(ORDER-BY-句))  
  * [ ] [1.1.5_結合(内部結合)](#115-結合(内部結合))  
  * [ ] [1.1.6_結合(外部結合)](#116-結合(外部結合))  
   

</details>

# 第一章：`SQL`
  * 標準SQL: JIS X 3005 で定義
## データ定義言語(DDL)とデータ操作言語(DML)
  * __データ定義言語__: `D`ata `D`efinition `L`aunguage

    | 命令     | 説明          |
    | ------ | ----------- |
    | CREATE | テーブル・ビューの作成 |
    | DROP   | テーブル・ビューの削除 |  

  * __データ操作言語__: `D`ata `M`anipulation `L`aunguage

    | 命令     | 説明  |
    | ------ | -------------- |
    | SELECT | 紹介  |
    | INSERT | 追加  |
    | UPDATE | 更新  |
    | DELETE | 削除  |

# 1.1 SELECT文
## 射影と選択
  * 射影： 属性(列)を抽出 (SELECT DISTINCT)
  * 選択： タプル(行)を抽出 (WHERE)

    | 演算  | 式              | SQL                             |
    | --- | -------------- | ------------------------------- |
    | 射影  | R[A1, A2, ・・・] | `SELECT DISTINCT` A1, A2 FROM R |
    | 選択  | R[X 比較演算式 Y]   | SELECT * FROM R `WHERE` X 比較演算子 Y |

# 1.1.1 選択項目リスト
  * 選択項目リスト = SELECTに指定可能なもの 
## 演算子
  * 算術演算子
  * 比較演算子
  * 連結演算子(以下例 `||`)
    ```sql:||
    SELECT '商品名=' || 商品名 AS 名前 FROM 商品
    ```

## 相関名
  * ASを用いて別名を付けることが可能
    * `省略することも可能`
        ```sql:AS
        SELECT X.受注番号, Y.受注日, Y.得意先名 FROM 受注 X, 得意先 Y WHERE X.得意先コード = Y.得意先コード
        ```
## `DISTINCT`
  * 重複するタプルを排除
    ```sql:DISTINCT
    SELECT DISTINCT 単価 FROM 得意先
    ```

## `COALESCE(引数1, 引数2, ・・・・)`
  * `NULL値の処理に用いられる`
  * 引数を1から順に評価し、NULLでないものを返却
    ```sql:COALESCE
    SELECT DISTINCT 単価 FROM 得意先
    ```

## `CASE WHEN 条件式 THEN 値1 ELSE 値2 END`
  * `条件`を考慮
    ```sql:CASE
    SELECT 会員番号, SUM (CASE WHEN 入館時刻 < '1200' THEN 1 ELSE 0 END) AS B1 FROM タイムテーブル
    ```
    * ※ COUNTの場合、ELSEで返す値は `NULL` にする必要あり。(0はカウント対象のため)

### Tips
  * 3値理論
    * 真：　True
    * 偽：　False
    * `不定： unknown`

---
---
# 1.1.2 SELECT文で使う条件設定

## `BETWEEN AND`
* 範囲を指定する
  ```sql:BETWEEN
  WHERE 受注日 BETWEEN '20191213' AND '20200110' 
  ```
  > 以下と同等の評価になる
    ```sql:example
    WHERE 受注日 >= '20191213' AND 受注日 <= '20200110' 
    ```

## `IN('X', 'Y')`
* 指定した値のタプルのみが抽出される
  ```sql:IN
  WHERE 受注日 IN ('20191215', '20200215')
  ```

## `LIKE`
* 文字列中の一部分のみ条件指定する場合に使用
  ```sql:LIKE
  WHERE 担当者 LIKE '三好%'
  ```
  > 前方一致、後方一致、中間一致は上記を用いて指定可能
  * `%`: 0~n桁の任意文字列
  * `_`: 1文字の任意文字列

## `NOT`
* 条件の否定に使用
  ```sql:NOT
  WHERE 受注日 NOT BEETWEEN '20191215' AND '20200115'
  ```
  ```sql:NOT
  WHERE 受注日 IS NOT NULL
  ```

### Tips
* `NOT`, `AND`,  `OR`の優先順位
  ```sql
  SELECT 社員 FROM 社員テーブルWHERE NOT (入社年度 <= (2005 - 3) AND 職種 = '技術') OR 初級シスアド合格 = 'Yes'
  ```
  > 入社３年経過 AND 初級システムアド未合格, または技術職以外の人
  ( `NOT > AND > OR` )

---
---
# 1.1.3 GROUP BY句と集約関数

## 基本構文
```sql:groupBy
SELECT 列名, ・・・ FROM テーブル名 GROUP BY グループ化する列名 HAVING 条件式
```

## 集約関数

| 関数                  | 説明         |
| ------------------- | ---------- |
| AVG(列名)             | 平均値        |
| MAX(列名)             | 最大値        |
| MIN(列名)             | 最小値        |
| SUM(列名)             | 合計値        |
| COUNT(*)            | タプル数       |
| COUNT (DISTINCT 列名) | 重複を除いたタプル数 |

## GROUP BY 句
* 選択項目リストには以下のみが指定可能
  1. ```GROUP BY 列A``` に指定した`列A`
  2. 集約関数
  3. 定数
    ```sql
    SELECT 受注番号, SUM(数量) AS 数量合計 FROM 受注明細 GROUP BY 受注番号
    ```

## HAVING 句
* グループ化した結果に対して、条件式を定義可  
例) 以下は3行以上のタプルのみを抽出する場合の指定 

    ```sql
    SELECT 受注番号, SUM(数量) AS 数量合計 FROM 受注明細 GROUP BY 受注番号 HAVING COUNT (*) >= 3
    ```
---
---
# 1.1.4 整列(ORDER BY 句)

## `ORDER BY 列A/整数N [ASC]`
* ※ASCは省略可能
* 列A を 昇順(ascending) で並べる
* 整数N が指定されている場合、左からN列目が昇順で並べられる

## `ORDER BY 列A/整数N DESC`
* 列A を 降順(descending) で並べる
* 整数N が指定されている場合、左からN列目が降順で並べられる

---
---

# 1.1.5 結合(内部結合)
構文1:  
* FROM句にテーブルを複数指定し、WHERE句に結合条件を指定
  ```sql
  SELECT 列名, ・・・ FROM テーブル1, テーブル2 WHERE テーブル1.列名 = テーブル2.列名
  ```
構文2:  
* [INNER] JOIN 句を使用し、ON句 または USING句 で結合条件を指定 
  ```sql
  SELECT 列名, ・・・ FROM テーブル1 [INNER] JOIN テーブル2 ON テーブル1.列名 = テーブル2.列名
  ```
  ```sql
  SELECT 列名, ・・・ FROM テーブル1 [INNER] JOIN テーブル2 USING(列名, ・・・)
  ```
* 自然結合の場合、NATURAL JOINを使用 (その際、ON / USING句は不要)
* JOIN句に 何も指定しない場合は 内部結合(INNER JOIN)される  
  * __内部結合__ : 結合した全ての表に存在する行のみを対象として結果を返す

## 内部結合と外部結合
  * 外部結合
    * 左外部結合 : 
      ```sql
      ・・ テーブル1 LEFT [OUTER] JOIN テーブル2　ON テーブル1.列名 = テーブル2.列名 
      ```
    * 右外部結合 :  
      ```sql
      ・・ テーブル1 RIGHT [OUTER] JOIN テーブル2　ON テーブル1.列名 = テーブル2.列名 
      ```
    * 全外部結合 : 
      ```sql
      ・・ テーブル1 FULL [OUTER] JOIN テーブル2　ON テーブル1.列名 = テーブル2.列名
      ```
     
      ![内部結合と外部結合](https://gizumon.github.io/MarkDown/images/高度情報処理/内部結合と外部結合.PNG)
    
      | 演算  | 式               |
      | --- | --------------- |
      | 結合  | R[RA 比較演算子 SA]S |
      ```sql
      SELECT * FROM R, S WHERE RA 比較演算子 SA
      ```
## 等結合と自然結合
  * __等結合__ : 結合した属性が重複して保持される 
  * __自然結合__ : 結合した属性の重複は取り除かれる
  
  ![等結合と自然結合](https://gizumon.github.io/MarkDown/images/高度情報処理/等結合と自然結合.PNG)

# 1.1.6 結合(外部結合)
## ３表以上の
---
---

